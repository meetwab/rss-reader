# RSS 阅读器文章历史功能优化

## 功能概述

本次优化为 RSS 阅读器添加了文章历史记录和分页查看功能，让用户可以查看订阅源的所有历史文章，而不仅仅是最新的 3 篇。

## 新增功能

### 1. 文章历史记录 📚

- **自动保存**: 每次获取文章时自动保存到本地 JSON 文件
- **智能去重**: 通过文章链接自动去除重复文章
- **时间戳记录**: 记录文章的发布时间和获取时间
- **持久化存储**: 使用 `articles_history.json` 文件存储历史数据

### 2. 分页查看功能 📖

- **默认显示**: 首次进入订阅时显示最新的 3 篇文章
- **查看更多**: 提供 `[m]` 选项查看更多历史文章
- **历史模式**: 提供 `[h]` 选项直接进入历史文章浏览
- **分页导航**: 每页显示 3 篇文章，支持翻页查看

### 3. 增强的用户界面 🎨

- **文章信息**: 显示文章标题、链接、摘要、发布时间和获取时间
- **操作提示**: 清晰的菜单选项和操作指南
- **状态指示**: 显示当前查看模式（最新文章/历史文章）

## 技术实现

### 文件结构

```
demo/
├── demo_refactored.py          # 主程序（已优化）
├── subscriptions.json          # 订阅列表
├── articles_history.json       # 文章历史记录（新增）
├── test_new_features.py        # 功能测试脚本
└── demo_new_features.py        # 功能演示脚本
```

### 数据结构

#### 文章历史记录格式 (articles_history.json)
```json
{
  "https://example.com/rss": [
    {
      "title": "文章标题",
      "link": "https://example.com/article1",
      "summary": "文章摘要",
      "published": "2025-01-01T08:00:00",
      "fetch_time": "2025-01-01T08:30:00"
    }
  ]
}
```

### 核心类的变更

#### 1. FileHandler 类
```python
# 新增方法
+ load_articles_history()    # 加载文章历史
+ save_articles_history()    # 保存文章历史
```

#### 2. RssParser 类
```python
# 新增方法
+ get_articles_history()     # 获取历史文章（分页）
+ _update_articles_history() # 更新文章历史记录

# 修改方法
~ fetch_articles()           # 获取文章时同时更新历史
```

#### 3. UserInterface 类
```python
# 修改方法
~ show_articles_menu()       # 新增"查看更多"和"历史"选项
~ display_articles()         # 显示文章时间信息
~ handle_single_subscription_view() # 支持分页和历史查看
```

## 使用方法

### 基本操作流程

1. **查看订阅**: 选择要查看的订阅源
2. **浏览文章**: 默认显示最新 3 篇文章
3. **查看更多**: 
   - 按 `[m]` 查看更多文章
   - 按 `[h]` 进入历史文章模式
4. **翻页浏览**: 在历史模式下可以翻页查看所有文章

### 操作选项说明

| 选项 | 功能 |
|------|------|
| `[r]` | 刷新文章列表（获取最新文章） |
| `[m]` | 查看更多文章 |
| `[h]` | 查看历史文章 |
| `[b]` | 返回订阅列表 |
| `[0]` | 返回首页 |
| `[1-3]` | 查看对应文章详情 |

## 示例场景

### 场景 1: 新用户添加订阅
1. 用户在 1月1日 添加订阅链接 A
2. 系统获取并保存 3 篇最新文章
3. 文章自动保存到历史记录中

### 场景 2: 老用户查看历史
1. 用户在 1月10日 查看订阅链接 A
2. 默认显示最新 3 篇文章
3. 用户选择"查看更多"，可以看到从 1月1日 到 1月10日 的所有文章
4. 支持分页浏览，每页 3 篇文章

### 场景 3: 文章去重
1. 系统每次获取文章时自动检查是否为重复文章
2. 通过文章链接进行去重判断
3. 只有新文章才会被添加到历史记录

## 文件说明

### 核心文件
- `demo_refactored.py`: 主程序，包含所有功能实现
- `articles_history.json`: 自动生成的文章历史记录文件

### 测试文件
- `test_new_features.py`: 单元测试脚本，验证核心功能
- `demo_new_features.py`: 演示脚本，展示功能使用方法

## 运行方式

### 启动主程序
```bash
cd /Users/archerwang/Downloads/vscode/rss/demo
python3 demo_refactored.py
```

### 运行功能测试
```bash
python3 test_new_features.py
```

### 运行功能演示
```bash
python3 demo_new_features.py
```

## 优势特点

1. **数据持久化**: 文章历史永久保存，不会丢失
2. **智能管理**: 自动去重，避免重复存储
3. **用户友好**: 分页显示，避免信息过载
4. **时间追踪**: 清楚记录文章的获取和发布时间
5. **扩展性好**: 基于 JSON 存储，后期可轻松迁移到数据库

## 后续扩展建议

1. **数据库迁移**: 将 JSON 文件迁移到 SQLite 或其他轻量数据库
2. **搜索功能**: 添加文章标题和内容的搜索功能
3. **标签分类**: 为文章添加分类标签
4. **导出功能**: 支持将文章历史导出为不同格式
5. **统计功能**: 添加阅读统计和趋势分析

## 注意事项

- 文章历史文件会随着时间增长，建议定期清理或归档
- 网络请求失败时，历史文章仍然可以正常查看
- 首次使用时需要先添加订阅源才能体验完整功能
